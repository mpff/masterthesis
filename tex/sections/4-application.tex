\label{sec:4}
In this chapter the proposed methods will be applied and verified.
\cref{sec:4-means} offers a comparison between the elastic full Procrustes mean, the elastic mean and the full Procrustes mean over two datasets, with the goal of illustrating some properties of the elastic full Procrustes mean.
\cref{sec:4-penalty} briefly discusses the effect of the penalty parameter on the estimation.
\cref{sec:4-pfits} mentions pitfalls when comparing the mean to the elastic full Procrustes fits and discusses outliers.
Finally, \cref{sec:4-tounges} applies the proposed methods to an empirical dataset of tongue contours, which was kindly provided by Prof.\ Dr.\ Marianne \textsc{Pouplier}.


\section{Comparison to the Elastic and the Full Procrustes Mean}
\label{sec:4-means}
In this section we will estimate and compare the elastic mean, the full Procrustes mean and the elastic full Procrustes mean for two datasets.
The first dataset is the \texttt{digits3.dat} dataset provided in the \texttt{shapes} package \parencite{shapes} and originally collected by \cite{Anderson1997}, which has already been used throughout this thesis for illustrative purposes.
It consist of 30 handwritten digits \enquote*{3}, each of which was sampled in a regular fashion at 13 points along the digit, leading to sparse but somewhat regular observations.
The second dataset consists of ten simulated spirals, each of which is a sample of the curve $\beta(t) = t \cos(13t) + \iu \cdot t \sin(13t)$, evaluated $m_i \in [10,15]$ times over a noisy grid, with additional noise applied to the output, leading to sparse and irregular observations.
The code simulating these spirals was adapted from the \texttt{compute\_elastic\_mean} function's documentation in the \texttt{elasdics} package \parencite{elasdics}.
Because the spirals \enquote{speed up} w.r.t.\ $t$ towards the end ($t = 1$), they start out quite densely sampled but become increasingly sparser, making the mean estimation, especially close to $t=1$, a challenge.
The datasets are considered in two settings:
In the first, each dataset is considered as is, which means that all curves are centred and similarly aligned.
In the second, for each curve $\beta_i$ a random Euclidean similarity transform with translation $\xi_i \sim \mathcal{U}([\xi_\mathrm{min}, \xi_\mathrm{max}])$, rotation $\theta_i \sim \mathcal{U}([0,2\pi))$ and scaling $\lambda_i \sim \mathcal{U}([0.5,1.5])$ is drawn, where $\xi_\mathrm{min}, \xi_\mathrm{max}$ are set respectively to $\pm 60$ and $\pm 2$ for the digits and spirals.
The curves are then transformed by $\lambda_i e^{\iu \theta_i} \beta_i + \xi_i$.

The four sets of data curves and means, are show in \cref{fig:4-means}.
\begin{figure}
  \centering
  \begin{subfigure}{\textwidth}
    \centering
    \inputTikz{41-digit3-means}
    \caption{Means for \texttt{digits3.dat}.}
    \label{fig:41-digit3-means-a}
  \end{subfigure}\vspace{0.66em}\\
  \begin{subfigure}{\textwidth}
    \centering
    \inputTikz{41-digit3-means-rot}
    \caption{Means for \texttt{digits3.dat} with random Euclidean similarity transform applied.}
    \label{fig:41-digit3-means-b}
  \end{subfigure}\vspace{0.66em}\\
  \begin{subfigure}{\textwidth}
    \centering
    \inputTikz{41-spiral-means}
    \caption{Means for simulated sparse spirals.}
    \label{fig:41-spiral-means-a}
  \end{subfigure}\vspace{0.66em}\\
  \begin{subfigure}{\textwidth}
    \centering
    \inputTikz{41-spiral-means-rot}
    \caption{Means for simulated sparse spirals with random Euclidean similarity transform applied.}
    \label{fig:41-spiral-means-b}
  \end{subfigure}
  \caption{Comparison of three mean types: Elastic mean (blue), full Procrustes mean (green) and elastic full Procrustes mean (red), estimated over four sets of data curves (grey).
  Each mean is estimated as polygonal (light, 16 knots) and smooth (dark, 13 knots), where in the estimation of the two Procrustes means a 2nd order penalty was applied.
  Data: See \cref{sec:4-means}}
  \label{fig:4-means}
\end{figure}
Here, the elastic mean (blue) is estimated using \texttt{compute\_elastic\_mean} from the \texttt{elasdics} package.
The full Procrustes (green) and the elastic full Procrustes mean (red) are estimated using the methods proposed in \cref{sec:2,sec:3}, where for the full Procrustes mean the estimation is stopped before the warping alignment step during the first iteration.
Note that the full Procrustes mean calculated in this way is not exactly a minimizer of the sum of squared full Procrustes distance defined in \cref{def:2-fpdist}, but instead is a minimizer of the sum of squared full Procrustes distances on SRV level.
When comparing the different mean types in \cref{fig:4-means} we can see that, unlike the elastic mean, both Procrustes means are invariant with respect to all Euclidean similarity transforms, as the estimated mean is the same for the transformed and original datasets.
However for this very same reason, both Procrustes means hold no information about the scale or rotation of the original curves, as they are of unit-length and have a rotation dependent on the eigendecomposition of the covariance surface.
The elastic mean is invariant only with respect to re-parameterisation and translation, so that its scale and rotation match the original data curves.
It can therefore be meaningfully plotted together with the original curves, when they are centred.

Apart from illustrating these properties, \cref{fig:4-means} provides two important validation checks for the estimation procedure proposed in \cref{sec:2,sec:3}.
Firstly, as stated, the estimated elastic full Procrustes mean is invariant to all Euclidean similarity transforms, as the mean shapes do not change with transformations of the input curves.
Secondly, when considering untransformed curves, the estimated elastic full Procrustes mean shapes are very comparable to elastic mean shapes estimated with the method proposed in \cite{Steyer2021}.
This is especially notable when comparing the means in \cref{fig:4-means} (a) where the prominent \enquote{notch} in the centre of the mean shape is similarly pronounced for the elastic and the elastic full Procrustes means, but not for the (non-elastic) full Procrustes mean.
Taken together this shows that the proposed mean estimation method provides elastic mean estimates in the setting of sparse and irregular curves, which are invariant to all shape-preserving transformations.


\section{Effect of the Penalty Parameter on Estimated Means}
\label{sec:4-penalty}
The elastic full Procrustes mean is given by the leading eigenfunction of the complex covariance surface, which was estimated using tensor product P-splines.
As a consequence, the order of the roughness penalty applied in the estimation of the covariance surface directly influences the shape of the estimated mean function.
This can be seen in \cref{fig:4-penalty}, where a smooth mean was estimated for different penalties.
\begin{figure}
  \centering
  \begin{subfigure}{\textwidth}
  \inputTikz{41-digit3-pen}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
  \inputTikz{41-spiral-pen}
  \end{subfigure}
  \caption{Elastic full Procrustes mean under different penalties.
  Estimated using no penalty (left) and order 0/1/2 penalties (centre-left/centre-right/right) respectively, as well as 13 equidistant knots and linear B-splines on SRV level.
  Data: See \cref{fig:41-digit3-means-b,fig:41-spiral-means-b}}
  \label{fig:4-penalty}
\end{figure}
Here, in particular, the spiral mean shapes help to illustrate the penalty effect.
As mentioned in \cref{sec:4-means}, the spirals are evaluated in a way that makes them very sparse towards the end, leading to unstable mean estimates in that region.
By penalising $p$-th order differences between neighbouring coefficients, the penalty helps to stabilise the covariance estimation (and thereby the mean) in regions where observations are sparse, where the shape of the function is consequently dominated by the penalty.

The mean function on the far left in \cref{fig:4-penalty} was estimated using no penalty.
We can see that the spiral shape is estimated well in the beginning (central part), where observations are dense, but becomes increasingly unstable and wriggly towards the end (outer part).
The mean function on the centre-left was estimated using a zero order penalty.
A zero order penalty on a B-spline basis can be interpreted as a ridge-penalty on the basis coefficients, i.e.\ the basis coefficients (and therefore the estimated function) get shrunk towards zero in areas where observations are sparse.
It is important to note that the penalised covariance estimation is performed on SRV level and not on data curve level, which means the ridge penalty shrinks the estimated SRV mean towards zero.
However, this does not imply that the estimated mean on data curve level also gets shrunk towards zero.
In fact, a ridge penalty on SRV level only shrinks the \emph{absolute velocity} of the mean on data curve level towards zero, but should not directly influence the \emph{direction} of the mean curve.
This can be seen, when comparing the zero order penalty spiral mean (centre-left) to the higher order penalty spiral means (right) and noting that, as a consequence of the decreased absolute velocity, it is relatively \enquote{shorter} towards the end when compared to the beginning of the spiral.
The higher order penalties may be interpreted as smoothing the SRV mean function towards a polynomial of degree $p-1$ in areas where the penalty dominates, which means a constant function for the first order penalty and a linear function for the second order penalty \parencite[see e.g.][435]{FahrmeierEtAl2013}.
\todo{Kann man das so einfach Ã¼bertrage?}
Looking at the means for $p = 1,2$ in \cref{fig:4-penalty}, these differences are already hard to spot.
The order two mean (right) is slightly longer towards the end, indicating a speed up, which is caused by the penalisation towards a global linearly (increasing) velocity, compared to a more conservative penalisation towards a global constant velocity. 


\section{Elastic Full Procrustes Fits and Outliers}
\label{sec:4-pfits}
Although the elastic full Procrustes mean does not share the rotation, scale and translation of the input curves, it is still possible to visually compare it to them, by plotting the mean together with the elastic full Procrustes fits.
In this thesis, the elastic full Procrustes fits are calculated on SRV level as $\widetilde q^\mathrm{EP} = (\omega^\mathrm{opt}\cdot \widetilde q \circ \gamma^\mathrm{opt} ) \sqrt{\dot\gamma^\mathrm{opt}}$, where the optimal rotation and scaling alignment $\omega^\mathrm{opt} = \lambda^\mathrm{opt} e^{\iu \theta^\mathrm{opt}}$ and optimal warping alignment $\gamma^\mathrm{opt}$ of each curve to the mean are taken from the last iteration of the mean estimation step.
In \cref{fig:4-pfits-curve} the elastic full Procrustes mean and fits are plotted for the digits \enquote*{3} and simulated spiral datasets discussed in \cref{sec:4-means}, with random Euclidean similarity transforms applied to each curve.
\begin{figure}
  \centering
  \begin{subfigure}{\textwidth}
    \begin{subfigure}{0.48\textwidth}
      \inputTikz{4-digits3-pfits}
    \end{subfigure}\hfill%
    \begin{subfigure}{0.48\textwidth}
      \inputTikz{4-spirals-pfits}
    \end{subfigure}
    \caption{Centred elastic full Procrustes fits (grey) and smooth means (red).}
    \label{fig:4-pfits-curve}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \begin{subfigure}{0.48\textwidth}
      \inputTikz{4-digits3-pfits-srv}
    \end{subfigure}\hfill%
    \begin{subfigure}{0.48\textwidth}
      \inputTikz{4-spirals-pfits-srv}
    \end{subfigure}
    \caption{Elastic full Procrustes fits (grey) and piece-wise-linear means (red) on SRV level.}
    \label{fig:4-pfits-srv}
  \end{subfigure}
  \caption{Elastic full Procrustes means and fits for digits (left) and spirals (right). Parameters: Second order penalty and linear B-splines, with 13 (left) and 19 (right) equidistant knots. Data: See \cref{fig:41-digit3-means-b,fig:41-spiral-means-b}}
  \label{fig:4-pfits}
\end{figure}
This alignment works very well for the simulated spirals and is more fuzzy for the digits, due to their greater variability in shape. 

In general, one has to be careful when interpreting these plots.
For example, it can be seen that the estimated mean does not necessarily follow the \enquote{centre of mass} of the aligned curves. 
One reason for this is that the mean is calculated on SRV level, meaning we may set an arbitrary translation for the mean on data curve level.
Here, the Procrustes fits and the mean function are centred, but a natural alternative might be to have all curves start at the origin, with both choices leading to very different, but equally valid, visual representations.
On SRV level, displayed in \cref{fig:4-pfits-srv}, it should also be taken into account that the mean is calculated from a smooth covariance surface, which was estimated using a roughness penalty where the SRV curves were assumed to be observed at the centre between the original curves observed corners (see \cref{sec:3-cov}).
On the other hand, the optimal rotation and scaling alignment was calculated by treating the normalised SRV curves as piece-wise-constant (see \cref{sec:3-pfits}).
It follows that the estimated mean on SRV level is also not necessarily the functional mean of the elastic full Procrustes fits.
This mismatch in estimation strategies might be a possible avenue of further research, and could be addressed by incorporating some form of smoothing into the estimation of the elastic full Procrustes fits, such as a variation of the curve smoothing proposed in \cref{app:a-smooth}.

Because of the great variation in '3' shapes in the \texttt{digits3.dat} dataset, there are some curves that cannot be properly aligned.
Four outlier shapes are shown in \cref{fig:4-outliers}, which were classified using their distance to the mean (left). 
\begin{figure}
  \centering
  \begin{subfigure}[t]{0.60\textwidth}
    \begin{subfigure}{0.40\textwidth}
      \centering
      \inputTikz{4-outlier-dist}
    \end{subfigure}
    \begin{subfigure}{0.60\textwidth}
      \centering
      \inputTikz{4-outlier}
    \end{subfigure}
    \caption{Distribution of elastic full Procrustes distances to the estimated mean (red) with four largest outliers (grey).}
  \end{subfigure}
  \begin{subfigure}[t]{0.40\textwidth}
    \centering
    \inputTikz{4-outlier-bopt}
    \caption{Distribution of the optimal scaling alignment parameter of each elastic Procrustes fit.}
  \end{subfigure}
  \caption{Elastic full Procrustes distances, outliers and estimated optimal scaling. Parameters: See \cref{fig:4-pfits}. 
  Data: See \cref{fig:41-digit3-means-b,fig:41-spiral-means-b}}
  \label{fig:4-outliers}
\end{figure}
One prominent feature of the full Procrustes mean is its relative robustness to outliers, when compared to the normal and partial Procrustes means.
This comes from the additional scaling alignment, which allows for shrinkage of any outlier curve towards zero, which can be seen for curves $1$ and $4$ in \cref{fig:4-outliers} (right).
Because the warping alignment is performed between the elastic full Procrustes fit and the mean curve, it might be important to better understand how it is affected by bad rotation and scaling alignment.
While a bad scaling alignment does not seem to be immediately problematic, as the warping alignment only takes into account the \emph{relative} distances over $t$ between the aligned and the mean curve, a bad rotation alignment will most likely always lead to a bad warping alignment.
However, because of the discussed shrinkage, these outliers are only problematic when considering the alignment of single curves and do not have a strong influence on the estimated means shape when their number is small.


\section{Analysis of Variations in Tongue Shapes}
\label{sec:4-tounges}
Mean and distance estimation for planar shapes extracted from imagery is a typical use-case for the proposed methods.
In this section a dataset consisting of tongue contours obtained from ultrasound recordings and their phonetic context is analysed.
The data was kindly provided by Prof.\ Dr.\ Marianne \textsc{Pouplier} and was gathered in an experimental setting from 6 native German speakers, each of whom was recorded speaking the same set of ficticious words over multiple repetitions.
Each word is a combination of two flanking vowels such as 'aa' or 'ii' and one consonant such as 'd' or 'l', leading to words such as 'pada', 'pidi', 'pala' or 'pili'.
The tongue contours follow the centre of the tongue and are extracted from the ultrasound recordings at times corresponding to the centre of consonant articulation, which is estimated from the acoustic signal.
Furthermore, care was taken to observe the tongues over their full length, from their tips to the Hoyid bone (German: Zungenbein),  which means we can naturally treat them as planar curves $\beta : [0,1] \rightarrow \mathbb{C}$ \parencite[see][]{consulting}.
While there is earlier work on functional data approaches to tongue shape analysis \parencite{CederbaumEtAl2016,Davidson2006,PouplierEtAl2014}, these approaches do not account for shape invariance in their estimation.
Procrustes analysis can account for anatomical differences between speakers, such as their differing sizes, or measurement inconsistencies between iterations, such as differences in orientation of the ultrasound device.
At the same time, the tongue is a flexible muscle capable of stretching, bending and compressing itself, providing some indication that an elastic analysis is appropriate. 
Therefore, the tongue shapes will be analysed using the elastic full Procrustes mean and distance.

The dataset we analyse consists of tongue shapes during articulation of the consonants 'd', 'l', 'n' and 's', for each of which there are multiple observations over two vowel contexts ('aa' and 'ii') and six speakers.
The shapes will vary between consonants, vowel context and speaker and also, per speaker, over multiple repetitions.
However, it is not immediately clear which factors are relatively more important for tongue shape than others.
We are therefore interested in questions such as:
Does tongue shape vary more strongly between vowel context than between consonants?
Do individual speakers have a consistent tongue shape per word between their repetitions?
Does each speakers individual way of speaking influence tongue shape more strongly than the actual consonant spoken?
To answer these questions, the dataset is grouped hierarchically, by consonants and vowel contexts and means are estimated for each grouping structure, one total mean over all observations belonging to the specific combination of consonants and vowels, and 6 speaker-wise means.
Then, to get a measure for the variability of tongue shapes inside a specific group, elastic full Procrustes distances to the mean are calculated and their distribution compared.

The results can be seen in \cref{fig:4-tounges}.
\begin{figure}
  \centering
  \advance\leftskip-1cm
  \begin{subfigure}[t]{0.72\textwidth}
    \centering
    \inputTikz{44-tounge-means}
    \centering
    \caption{Total (black, dashed) and per-speaker means (coloured) by vowels and consonants, with per-speaker elastic full Procrustes fits (grey). 
    Per-speaker means and -fits are rotationally aligned to the respective total means.}
    \label{fig:4-tongue-means}
  \end{subfigure}%
  \begin{subfigure}[t]{0.40\textwidth}
    \centering
    \inputTikz{44-tounge-dists}
    \centering
    \caption{Distribution of elastic full Procrustes distances to respective mean (see \cref{fig:4-tongue-means}) total (black) and by speaker (coloured), where \enquote*{t} indicates distances to the total mean.}
    \label{fig:4-tongue-dists}
  \end{subfigure}
  \caption{Right column and bottom row correspond to means and distances over all vowels or all consonants respectively, with the bottom right means corresponding to global and global per-speaker means and distances.
    Parameters: Estimated using 13 equidistant knots, linear B-splines on SRV level and a 2nd order penalty.
    Data: Prof.\ Dr.\ M.\ \textsc{Pouplier}.}
  \label{fig:4-tounges}
\end{figure}
The box plots in \cref{fig:4-tongue-dists} show the distributions of the elastic full Procrustes fits' distances to their  mean in \cref{fig:4-tongue-means}.
We can note that although the tongue shapes were measured during consonant articulation, the vowel context has a greater influence on their shape, as grouping by vowel (comparing the right to the other columns) consistently decreases variability more so than grouping by consonant (comparing the bottom to the other rows). 
When comparing the distance distributions for total means (black) this last part is especially noticeable, as the mean distance hardly changes when grouping by consonant.
It seems that without accounting for the individual speaker, the consonant only explains very little in terms of variability of the tongue shapes, as when performing the same comparison over the per-speaker means, we can see that grouping by consonants reduces variability in the dataset slightly.
This indicates that there is no strong effect of the spoken consonant on tongue shape over all speakers, but rather that this effect depends on each speaker individually.
Finally, the smallest variability is measured over the per-speaker means for repetitions of the same word (central eight plots), indicating that tongue shape is very consistent on a per-speaker basis.

\todo[inline]{One paragraph for possible future extensions.}
